{"version":3,"sources":["woo-blocks.js"],"names":["wc","wcBlocksRegistry","React","wc_reepay","PAYMENT_METHOD_NAME","URL","document","currentScript","src","searchParams","get","registerPaymentMethod","createElement","useEffect","useSelect","useDispatch","wp","data","__","i18n","getSetting","wcSettings","PAYMENT_STORE_KEY","wcBlocksData","decodeEntities","htmlEntities","settings","label","title","Tokens","tokens","map","token","Token","push","id","className","paymentMethodData","select","getPaymentMethodData","__internalSetPaymentMethodData","setPaymentMethodData","Img","image","image_alt","name","Radio","type","value","onChange","event","console","log","target","Label","htmlFor","masked","expiry_month","expiry_year","key","Content","props","eventRegistration","emitResponse","onPaymentProcessing","onCheckoutAfterProcessingWithSuccess","onCheckoutAfterProcessingWithError","unsubscribe1","async","result","unsubscribe2","processingResponse","paymentDetails","reepay_id","accept_url","buildModalCheckout","unsubscribe3","responseTypes","SUCCESS","ERROR","FAIL","description","PaymentMethodLabel","components","text","content","edit","savedTokenComponent","canMakePayment","ariaLabel","supports","features","showSavedCards","includes","showSaveOption"],"mappings":"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","file":"woo-blocks.min.js","sourcesContent":["if (wc && wc.wcBlocksRegistry && React && wc_reepay) {\r\n    const PAYMENT_METHOD_NAME = (new URL(document.currentScript.src)).searchParams.get('name');\r\n\r\n    if (!PAYMENT_METHOD_NAME) {\r\n        throw 'Script ' + document.currentScript.src + ' - name is undefined';\r\n    }\r\n\r\n    /**\r\n     * External dependencies\r\n     */\r\n    const {registerPaymentMethod} = wc.wcBlocksRegistry;\r\n    const {createElement, useEffect} = React;\r\n    const {useSelect, useDispatch} = wp.data;\r\n    const {__} = wp.i18n;\r\n    const {getSetting} = wc.wcSettings;\r\n    const {PAYMENT_STORE_KEY} = wc.wcBlocksData;\r\n    const {decodeEntities} = wp.htmlEntities;\r\n\r\n    const settings = getSetting(PAYMENT_METHOD_NAME + '_data', {});\r\n\r\n    const label = decodeEntities(settings.title) || __('Reepay checkout', 'reepay-checkout-gateway');\r\n\r\n    const Tokens = createElement(() => {\r\n        const tokens = settings.tokens.map((token) => createElement(Token, token))\r\n\r\n        tokens.push(createElement(Token, {\r\n            id: 'new',\r\n        }))\r\n\r\n        return createElement('ul', {\r\n            className: 'reepay-blocks-list'\r\n        }, ...tokens)\r\n    });\r\n\r\n    const Token = (token) => {\r\n        const {paymentMethodData} = useSelect((select) => ({\r\n            paymentMethodData: select(PAYMENT_STORE_KEY).getPaymentMethodData()\r\n        }));\r\n\r\n        const {__internalSetPaymentMethodData: setPaymentMethodData} = useDispatch(PAYMENT_STORE_KEY);\r\n\r\n        const Img = token.image ? createElement('img', {\r\n            'src': token.image,\r\n            'image_alt': token.label,\r\n        }) : null;\r\n\r\n        const name = `wc-${PAYMENT_METHOD_NAME}-payment-token`;\r\n\r\n        const Radio = createElement('input', {\r\n            'type': 'radio',\r\n            'name': name,\r\n            'id': `${name}-${token.id}`,\r\n            'value': token.id,\r\n            'onChange': (event) => {\r\n                if( paymentMethodData[name] !== token) {\r\n                    console.log(event.target.value)\r\n                    setPaymentMethodData({\r\n                        ...paymentMethodData,\r\n                        [name]: event.target.value\r\n                    })\r\n                }\r\n            }\r\n        })\r\n\r\n        const Label = createElement(\r\n            'label',\r\n            {\r\n                'htmlFor': `wc-${PAYMENT_METHOD_NAME}-payment-token-${token.id}`,\r\n            },\r\n            Img,\r\n            'new' === token.id ?\r\n                __('Use a new payment method', 'reepay-checkout-gateway') :\r\n                `${token.masked} ${token.expiry_month}/${token.expiry_year}`\r\n        )\r\n\r\n        return createElement(\r\n            'li',\r\n            {\r\n                key: token.id,\r\n                className: 'reepay-blocks-list-item'\r\n            },\r\n            Radio,\r\n            Label,\r\n        )\r\n    }\r\n\r\n    /**\r\n     * Content component\r\n     */\r\n    const Content = createElement((props) => {\r\n        const { eventRegistration, emitResponse } = props;\r\n        const { onPaymentProcessing, onCheckoutAfterProcessingWithSuccess,  onCheckoutAfterProcessingWithError} = eventRegistration;\r\n\r\n        useEffect( () => {\r\n            const unsubscribe1 = onPaymentProcessing( async (result) => {\r\n                console.log('onPaymentProcessing', result);\r\n            } );\r\n\r\n            const unsubscribe2 = onCheckoutAfterProcessingWithSuccess( async (result) => {\r\n                console.log('onCheckoutAfterProcessingWithSuccess',result);\r\n                const { processingResponse } = result;\r\n                const { paymentDetails } = processingResponse;\r\n\r\n                if (paymentDetails.reepay_id && paymentDetails.accept_url) {\r\n                    wc_reepay.buildModalCheckout(paymentDetails.reepay_id, paymentDetails.accept_url);\r\n                }\r\n            } );\r\n\r\n            const unsubscribe3 = onCheckoutAfterProcessingWithError( async (result) => {\r\n                console.log('onCheckoutAfterProcessingWithSuccess',result);\r\n            } );\r\n\r\n            // Unsubscribes when this component is unmounted.\r\n            return () => {\r\n                unsubscribe1();\r\n                unsubscribe2();\r\n                unsubscribe3();\r\n            };\r\n        }, [\r\n            emitResponse.responseTypes.SUCCESS,\r\n            emitResponse.responseTypes.ERROR,\r\n            emitResponse.responseTypes.FAIL,\r\n        ] );\r\n\r\n        if(settings.tokens) {\r\n            return Tokens;\r\n        } else {\r\n            return decodeEntities(settings.description || \"\");\r\n        }\r\n    }, null);\r\n\r\n    /**\r\n     * Label component\r\n     *\r\n     * @param {*} props Props from payment API.\r\n     */\r\n    const Label = createElement(props => {\r\n        const {PaymentMethodLabel} = props.components;\r\n        return createElement(PaymentMethodLabel, {text: label})\r\n    }, null)\r\n\r\n    /**\r\n     * Payment method config.\r\n     */\r\n    registerPaymentMethod({\r\n        name: PAYMENT_METHOD_NAME,\r\n        label: Label,\r\n        content: Content,\r\n        edit: Content,\r\n        savedTokenComponent: null,\r\n        canMakePayment: () => true,\r\n        ariaLabel: label,\r\n        supports: {\r\n            features: settings.supports ?? [],\r\n            showSavedCards: settings.supports.includes('cards'),\r\n            showSaveOption: settings.supports.includes('cards')\r\n        },\r\n    });\r\n}\r\n"]}