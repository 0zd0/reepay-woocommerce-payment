{"version":3,"sources":["checkout.js"],"names":["window","rp","Reepay","ModalCheckout","jQuery","$","wc_checkout_params","document","ajaxComplete","event","xhr","settings","url","checkout_url","indexOf","data","responseText","result","parseJSON","hasOwnProperty","wc_reepay","buildModalCheckout","reepay","id","accept_url","e","console","warn","ready","location","hash","replace","params","URLSearchParams","rid","get","setTimeout","history","pushState","title","pathname","reepay_id","WC_Gateway_Reepay_Checkout","payment_type","show","WindowCheckout","addEventHandler","Event","Accept","log","redirect_url","prop","setUrlParameter","href","Cancel","throw_error","cancel_text","Close","removeClass","unblock","Error","error_text","errorThrown","form","remove","message","before","scrollElement","length","animate","scrollTop","offset","top","key","value","baseUrl","split","urlQueryString","newParam","updateRegex","RegExp","removeRegex","match"],"mappings":"AAIAA,OAAOC,GAAK,IAAIC,OAAOC,cAEvBC,QAAQ,SAAUC,GACd,aAGA,GAAmC,oBAAvBC,mBACR,OAAO,EAGXD,EAAGE,UAAWC,cAAc,SAAWC,EAAOC,EAAKC,GAC/C,GAAOA,EAASC,MAAQN,mBAAmBO,cAAoBF,EAASC,IAAIE,QAAS,2BAA8B,EAAM,CACrH,MAAMC,EAAOL,EAAIM,aAGjB,IACI,MAAMC,EAASZ,EAAEa,UAAWH,GAG5B,IAAOE,EAAOE,eAAgB,sBAC1B,OAAO,EAGXC,UAAUC,mBAAoBJ,EAAOK,OAAOC,GAAIN,EAAOO,YACzD,MAAQC,GAGN,OAFAC,QAAQC,KAAMF,IAEP,OAKnBpB,EAAGE,UAAWqB,OAAM,WAChB,GAAK5B,OAAO6B,SAASC,KAAKhB,QAAS,iBAAoB,EAAI,CACvD,MAAMF,EAAML,SAASsB,SAASC,KAAKC,QAAS,eAAe,IACvDC,EAAS,IAAIC,gBAAiBrB,GAElC,IAAIsB,EAAMF,EAAOG,IAAK,OAClBX,EAAaQ,EAAOG,IAAK,cAE7BnC,OAAOoC,YAAY,WACfhB,UAAUC,mBAAoBa,EAAKV,GACnCa,QAAQC,UAAW,GAAI/B,SAASgC,MAAOvC,OAAO6B,SAASW,YACxD,YAKfpB,UAAY,CAORC,mBAAoB,SAAWoB,EAAWjB,GACW,YAA5CkB,2BAA2BC,aAE5B3C,OAAOC,GAAG2C,KAAMH,GAGhBzC,OAAOC,GAAK,IAAIC,OAAO2C,eAAgBJ,GAG3CzC,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMC,QAAQ,SAAUjC,GACtDW,QAAQuB,IAAK,SAAUlC,GAEvB,IAAImC,EAAe1B,EACnB,IAAM,IAAI2B,KAAQpC,EACdmC,EAAe9B,UAAUgC,gBAAiBF,EAAcC,EAAMpC,EAAKoC,IAGvEnD,OAAO6B,SAASwB,KAAOH,KAG3BlD,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMO,QAAQ,SAAUvC,GACtDW,QAAQuB,IAAK,SAAUlC,GACvBK,UAAUmC,YAAab,2BAA2Bc,gBAGtDxD,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMU,OAAO,SAAU1C,GAC1CV,EAAE,iBACRqD,YAAa,cAAeC,UACjCjC,QAAQuB,IAAK,QAASlC,MAG1Bf,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMa,OAAO,SAAU7C,GACrDW,QAAQuB,IAAK,QAASlC,GACtBK,UAAUmC,YAAab,2BAA2BmB,gBAI1DN,YAAa,SAAWO,GACpB1D,QAAQ,SAAUC,GACd,IAAI0D,EAAO1D,EAAE,iBACb0D,EAAKL,YAAa,cAAeC,UACjCtD,EAAE,4BAA4B2D,SAC9B,IAAIC,EAAU,wHAA0HH,EAAc,mBACtJC,EAAKG,OAAOD,GACZ,IAAIE,EAAgB9D,EAAE,iFACjB8D,EAAcC,SACfD,EAAgB9D,EAAE,mBAElB8D,EAAcC,QACd/D,EAAE,cAAcgE,QAAQ,CACpBC,UAAYH,EAAcI,SAASC,IAAM,KAC1C,SAcfpB,gBAAiB,SAAWxC,EAAK6D,EAAKC,GAClC,IAAIC,EAAU/D,EAAIgE,MAAM,KAAK,GACzBC,EAAiB,IAAMjE,EAAIgE,MAAM,KAAK,GACtCE,EAAWL,EAAM,IAAMC,EACvB1C,EAAS,IAAM8C,EAGnB,GAAID,EAAgB,CAChB,IAAIE,EAAc,IAAIC,OAAO,SAAYP,EAAM,SAC3CQ,EAAc,IAAID,OAAO,SAAYP,EAAM,gBAI3CzC,EAFA,MAAO0C,GAAqD,KAAVA,GAClD1C,EAAS6C,EAAe9C,QAAQkD,EAAa,OAC7BlD,QAAQ,QAAS,IAEY,OAAtC8C,EAAeK,MAAMH,GACnBF,EAAe9C,QAAQgD,EAAa,KAAOD,GAG3CD,EAAiB,IAAMC,EAOxC,OAAOH,GAFP3C,EAAoB,MAAXA,EAAiB,GAAKA","file":"checkout.min.js","sourcesContent":["/* global wc_checkout_params */\n/* global Reepay */\n\n// Preload ModalCheckout\nwindow.rp = new Reepay.ModalCheckout();\n\njQuery( function( $ ) {\n    'use strict';\n\n    // wc_checkout_params is required to continue, ensure the object exists\n    if ( typeof wc_checkout_params === 'undefined' ) {\n        return false;\n    }\n\n    $( document ).ajaxComplete( function ( event, xhr, settings ) {\n        if ( ( settings.url === wc_checkout_params.checkout_url ) || ( settings.url.indexOf( 'wc-ajax=complete_order' ) > -1 ) ) {\n            const data = xhr.responseText;\n\n            // Parse\n            try {\n                const result = $.parseJSON( data );\n\n                // Check is response from payment gateway\n                if ( ! result.hasOwnProperty( 'is_reepay_checkout' ) ) {\n                    return false;\n                }\n\n                wc_reepay.buildModalCheckout( result.reepay.id, result.accept_url );\n            } catch ( e ) {\n                console.warn( e );\n\n                return false;\n            }\n        }\n    } );\n\n    $( document ).ready(function () {\n        if ( window.location.hash.indexOf( '#!reepay-pay' ) > -1 ) {\n            const url = document.location.hash.replace( '#!reepay-pay','' ),\n                params = new URLSearchParams( url );\n\n            let rid = params.get( 'rid' ),\n                accept_url = params.get( 'accept_url' );\n\n            window.setTimeout( function () {\n                wc_reepay.buildModalCheckout( rid, accept_url );\n                history.pushState( '', document.title, window.location.pathname );\n            }, 1000 );\n        }\n    });\n});\n\nwc_reepay = {\n    /**\n     * Build Modal Checkout\n     *\n     * @param reepay_id\n     * @param accept_url\n     */\n    buildModalCheckout: function ( reepay_id, accept_url ) {\n        if ( WC_Gateway_Reepay_Checkout.payment_type === 'OVERLAY' ) {\n            // Show modal\n            window.rp.show( reepay_id );\n            //rp = new Reepay.ModalCheckout( reepay_id );\n        } else {\n            window.rp = new Reepay.WindowCheckout( reepay_id );\n        }\n\n        window.rp.addEventHandler( Reepay.Event.Accept, function( data ) {\n            console.log( 'Accept', data );\n\n            let redirect_url = accept_url;\n            for ( let prop in data ) {\n                redirect_url = wc_reepay.setUrlParameter( redirect_url, prop, data[prop] );\n            }\n\n            window.location.href = redirect_url;\n        } );\n\n        window.rp.addEventHandler( Reepay.Event.Cancel, function( data ) {\n            console.log( 'Cancel', data );\n            wc_reepay.throw_error( WC_Gateway_Reepay_Checkout.cancel_text )\n        } );\n\n        window.rp.addEventHandler( Reepay.Event.Close, function( data ) {\n            var form = $('form.checkout');\n            form.removeClass( 'processing' ).unblock();\n            console.log( 'Close', data );\n        } );\n\n        window.rp.addEventHandler( Reepay.Event.Error, function( data ) {\n            console.log( 'Error', data );\n            wc_reepay.throw_error( WC_Gateway_Reepay_Checkout.error_text )\n        } );\n    },\n\n    throw_error: function ( errorThrown ) {\n        jQuery( function( $ ) {\n            var form = $('form.checkout');\n            form.removeClass( 'processing' ).unblock();\n            $('.woocommerce-NoticeGroup').remove();\n            var message = '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\"><ul class=\"woocommerce-error\" role=\"alert\"><li>' + errorThrown + '</li></ul></div>';\n            form.before(message);\n            var scrollElement = $('.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout');\n            if (!scrollElement.length) {\n                scrollElement = $('.form.checkout');\n            }\n            if (scrollElement.length) {\n                $('html, body').animate({\n                    scrollTop: (scrollElement.offset().top - 100)\n                }, 1000);\n            }\n        });\n    },\n\n\n/**\n     * Add parameter for Url\n     *\n     * @param url\n     * @param key\n     * @param value\n     * @return {string}\n     */\n    setUrlParameter: function ( url, key, value ) {\n        var baseUrl = url.split('?')[0],\n            urlQueryString = '?' + url.split('?')[1],\n            newParam = key + '=' + value,\n            params = '?' + newParam;\n\n        // If the \"search\" string exists, then build params from it\n        if (urlQueryString) {\n            var updateRegex = new RegExp('([\\?&])' + key + '[^&]*');\n            var removeRegex = new RegExp('([\\?&])' + key + '=[^&;]+[&;]?');\n\n            if (typeof value === 'undefined' || value === null || value === '') { // Remove param if value is empty\n                params = urlQueryString.replace(removeRegex, \"$1\");\n                params = params.replace(/[&;]$/, \"\");\n\n            } else if (urlQueryString.match(updateRegex) !== null) { // If param exists already, update it\n                params = urlQueryString.replace(updateRegex, \"$1\" + newParam);\n\n            } else { // Otherwise, add it to end of query string\n                params = urlQueryString + '&' + newParam;\n            }\n        }\n\n        // no parameter was set so we don't need the question mark\n        params = params === '?' ? '' : params;\n\n        return baseUrl + params;\n    }\n};\n\n"]}