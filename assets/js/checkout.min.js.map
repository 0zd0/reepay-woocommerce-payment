{"version":3,"sources":["checkout.js"],"names":["window","rp","Reepay","ModalCheckout","jQuery","$","wc_checkout_params","document","ajaxComplete","event","xhr","settings","url","checkout_url","indexOf","data","responseText","result","parseJSON","hasOwnProperty","wc_reepay","buildModalCheckout","reepay","id","accept_url","cancel_url","e","console","warn","ready","location","hash","replace","params","URLSearchParams","rid","get","setTimeout","history","pushState","title","pathname","reepay_id","WC_Gateway_Reepay_Checkout","payment_type","show","WindowCheckout","addEventHandler","Event","Accept","log","redirect_url","prop","setUrlParameter","href","Cancel","Close","Error","key","value","baseUrl","split","urlQueryString","newParam","updateRegex","RegExp","removeRegex","match"],"mappings":"AAIAA,OAAOC,GAAK,IAAIC,OAAOC,cAEvBC,QAAQ,SAAUC,GACd,aAGA,GAAmC,oBAAvBC,mBACR,OAAO,EAGXD,EAAGE,UAAWC,cAAc,SAAWC,EAAOC,EAAKC,GAC/C,GAAOA,EAASC,MAAQN,mBAAmBO,cAAoBF,EAASC,IAAIE,QAAS,2BAA8B,EAAM,CACrH,MAAMC,EAAOL,EAAIM,aAGjB,IACI,MAAMC,EAASZ,EAAEa,UAAWH,GAG5B,IAAOE,EAAOE,eAAgB,sBAC1B,OAAO,EAGXC,UAAUC,mBAAoBJ,EAAOK,OAAOC,GAAIN,EAAOO,WAAYP,EAAOQ,YAC5E,MAAQC,GAGN,OAFAC,QAAQC,KAAMF,IAEP,OAKnBrB,EAAGE,UAAWsB,OAAM,WAChB,GAAK7B,OAAO8B,SAASC,KAAKjB,QAAS,iBAAoB,EAAI,CACvD,MAAMF,EAAML,SAASuB,SAASC,KAAKC,QAAS,eAAe,IACvDC,EAAS,IAAIC,gBAAiBtB,GAElC,IAAIuB,EAAMF,EAAOG,IAAK,OAClBZ,EAAaS,EAAOG,IAAK,cACzBX,EAAaQ,EAAOG,IAAK,cAE7BpC,OAAOqC,YAAY,WACfjB,UAAUC,mBAAoBc,EAAKX,EAAYC,GAC/Ca,QAAQC,UAAW,GAAIhC,SAASiC,MAAOxC,OAAO8B,SAASW,YACxD,YAKfrB,UAAY,CAQRC,mBAAoB,SAAWqB,EAAWlB,EAAYC,GACD,YAA5CkB,2BAA2BC,aAE5B5C,OAAOC,GAAG4C,KAAMH,GAGhB1C,OAAOC,GAAK,IAAIC,OAAO4C,eAAgBJ,GAG3C1C,OAAOC,GAAG8C,gBAAiB7C,OAAO8C,MAAMC,QAAQ,SAAUlC,GACtDY,QAAQuB,IAAK,SAAUnC,GAEvB,IAAIoC,EAAe3B,EACnB,IAAM,IAAI4B,KAAQrC,EACdoC,EAAe/B,UAAUiC,gBAAiBF,EAAcC,EAAMrC,EAAKqC,IAGvEpD,OAAO8B,SAASwB,KAAOH,KAG3BnD,OAAOC,GAAG8C,gBAAiB7C,OAAO8C,MAAMO,QAAQ,SAAUxC,GACtDY,QAAQuB,IAAK,SAAUnC,GACvBf,OAAO8B,SAASwB,KAAO7B,KAG3BzB,OAAOC,GAAG8C,gBAAiB7C,OAAO8C,MAAMQ,OAAO,SAAUzC,GACrDY,QAAQuB,IAAK,QAASnC,MAG1Bf,OAAOC,GAAG8C,gBAAiB7C,OAAO8C,MAAMS,OAAO,SAAU1C,GACrDY,QAAQuB,IAAK,QAASnC,GACtBf,OAAO8B,SAASwB,KAAO7B,MAY/B4B,gBAAiB,SAAWzC,EAAK8C,EAAKC,GAClC,IAAIC,EAAUhD,EAAIiD,MAAM,KAAK,GACzBC,EAAiB,IAAMlD,EAAIiD,MAAM,KAAK,GACtCE,EAAWL,EAAM,IAAMC,EACvB1B,EAAS,IAAM8B,EAGnB,GAAID,EAAgB,CAChB,IAAIE,EAAc,IAAIC,OAAO,SAAYP,EAAM,SAC3CQ,EAAc,IAAID,OAAO,SAAYP,EAAM,gBAI3CzB,EAFA,MAAO0B,GAAqD,KAAVA,GAClD1B,EAAS6B,EAAe9B,QAAQkC,EAAa,OAC7BlC,QAAQ,QAAS,IAEY,OAAtC8B,EAAeK,MAAMH,GACnBF,EAAe9B,QAAQgC,EAAa,KAAOD,GAG3CD,EAAiB,IAAMC,EAOxC,OAAOH,GAFP3B,EAAoB,MAAXA,EAAiB,GAAKA","file":"checkout.min.js","sourcesContent":["/* global wc_checkout_params */\n/* global Reepay */\n\n// Preload ModalCheckout\nwindow.rp = new Reepay.ModalCheckout();\n\njQuery( function( $ ) {\n    'use strict';\n\n    // wc_checkout_params is required to continue, ensure the object exists\n    if ( typeof wc_checkout_params === 'undefined' ) {\n        return false;\n    }\n\n    $( document ).ajaxComplete( function ( event, xhr, settings ) {\n        if ( ( settings.url === wc_checkout_params.checkout_url ) || ( settings.url.indexOf( 'wc-ajax=complete_order' ) > -1 ) ) {\n            const data = xhr.responseText;\n\n            // Parse\n            try {\n                const result = $.parseJSON( data );\n\n                // Check is response from payment gateway\n                if ( ! result.hasOwnProperty( 'is_reepay_checkout' ) ) {\n                    return false;\n                }\n\n                wc_reepay.buildModalCheckout( result.reepay.id, result.accept_url, result.cancel_url );\n            } catch ( e ) {\n                console.warn( e );\n\n                return false;\n            }\n        }\n    } );\n\n    $( document ).ready(function () {\n        if ( window.location.hash.indexOf( '#!reepay-pay' ) > -1 ) {\n            const url = document.location.hash.replace( '#!reepay-pay','' ),\n                params = new URLSearchParams( url );\n\n            let rid = params.get( 'rid' ),\n                accept_url = params.get( 'accept_url' ),\n                cancel_url = params.get( 'cancel_url' );\n\n            window.setTimeout( function () {\n                wc_reepay.buildModalCheckout( rid, accept_url, cancel_url );\n                history.pushState( '', document.title, window.location.pathname );\n            }, 1000 );\n        }\n    });\n});\n\nwc_reepay = {\n    /**\n     * Build Modal Checkout\n     *\n     * @param reepay_id\n     * @param accept_url\n     * @param cancel_url\n     */\n    buildModalCheckout: function ( reepay_id, accept_url, cancel_url ) {\n        if ( WC_Gateway_Reepay_Checkout.payment_type === 'OVERLAY' ) {\n            // Show modal\n            window.rp.show( reepay_id );\n            //rp = new Reepay.ModalCheckout( reepay_id );\n        } else {\n            window.rp = new Reepay.WindowCheckout( reepay_id );\n        }\n\n        window.rp.addEventHandler( Reepay.Event.Accept, function( data ) {\n            console.log( 'Accept', data );\n\n            let redirect_url = accept_url;\n            for ( let prop in data ) {\n                redirect_url = wc_reepay.setUrlParameter( redirect_url, prop, data[prop] );\n            }\n\n            window.location.href = redirect_url;\n        } );\n\n        window.rp.addEventHandler( Reepay.Event.Cancel, function( data ) {\n            console.log( 'Cancel', data );\n            window.location.href = cancel_url;\n        } );\n\n        window.rp.addEventHandler( Reepay.Event.Close, function( data ) {\n            console.log( 'Close', data );\n        } );\n\n        window.rp.addEventHandler( Reepay.Event.Error, function( data ) {\n            console.log( 'Error', data );\n            window.location.href = cancel_url;\n        } );\n    },\n\n    /**\n     * Add parameter for Url\n     *\n     * @param url\n     * @param key\n     * @param value\n     * @return {string}\n     */\n    setUrlParameter: function ( url, key, value ) {\n        var baseUrl = url.split('?')[0],\n            urlQueryString = '?' + url.split('?')[1],\n            newParam = key + '=' + value,\n            params = '?' + newParam;\n\n        // If the \"search\" string exists, then build params from it\n        if (urlQueryString) {\n            var updateRegex = new RegExp('([\\?&])' + key + '[^&]*');\n            var removeRegex = new RegExp('([\\?&])' + key + '=[^&;]+[&;]?');\n\n            if (typeof value === 'undefined' || value === null || value === '') { // Remove param if value is empty\n                params = urlQueryString.replace(removeRegex, \"$1\");\n                params = params.replace(/[&;]$/, \"\");\n\n            } else if (urlQueryString.match(updateRegex) !== null) { // If param exists already, update it\n                params = urlQueryString.replace(updateRegex, \"$1\" + newParam);\n\n            } else { // Otherwise, add it to end of query string\n                params = urlQueryString + '&' + newParam;\n            }\n        }\n\n        // no parameter was set so we don't need the question mark\n        params = params === '?' ? '' : params;\n\n        return baseUrl + params;\n    }\n};\n\n"]}